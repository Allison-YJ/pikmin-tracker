<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pikmin Manager</title>
    <!-- Favicon Fix: Emoji as Icon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŒ±</text></svg>">
    
    <!-- Tailwind for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Babel for in-browser JSX transpilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              sage: {
                DEFAULT: '#7A9482',
                light: '#F0F4F2',
                dark: '#637A6A',
              },
              'warm-white': '#FDFDFD',
              'soft-slate': '#6B7280',
            },
            fontFamily: {
              sans: ['Plus Jakarta Sans', 'sans-serif'],
            },
          }
        }
      }
    </script>
    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            -webkit-tap-highlight-color: transparent;
            background-color: #FDFDFD;
            margin: 0;
            padding: 0;
            opacity: 1 !important; /* Force visibility */
            display: block !important; /* Force display */
        }
        .sage-gradient-header {
            background: linear-gradient(135deg, #7A9482 0%, #8DA695 100%);
        }
        .form-card {
            box-shadow: 0 4px 20px -5px rgba(122, 148, 130, 0.08);
            border: 1px solid #f1f5f9;
        }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #FDFDFD; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="text-slate-800 min-h-screen">
    <div id="root"></div>

    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.2.4",
    "react-dom/client": "https://esm.sh/react-dom@19.2.4/client",
    "react/": "https://esm.sh/react@^19.2.4/"
  }
}
</script>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import ReactDOM from 'react-dom/client';

        console.log("App script loaded. Initializing...");

        // --- CONSTANTS ---
        const STORAGE_KEY = 'pikminData';

        const DECOR_TYPES = [
          'Roadside', 'Restaurant', 'Cafe', 'Sweet Shop', 'Movie Theater', 
          'Pharmacy', 'Zoo', 'Forest', 'Water', 'Post Office', 
          'Art Gallery', 'Airport', 'Station', 'Beach', 'Burger Shop', 
          'Library', 'Supermarket', 'Bakery', 'Park', 'Hair Salon', 
          'Clothes Store', 'Weather', 'Mountain', 'Theme Park', 'Bus Stop', 
          'Bridge', 'Hotel', 'Makeup', 'Curry Shop', 'Appliance Store'
        ];

        // Updated Color List: Removed 'Glow', Renamed 'Winged' to 'Wing'
        const PIKMIN_COLORS = ['Red', 'Yellow', 'Blue', 'White', 'Purple', 'Rock', 'Wing', 'Ice'];
        const PIKMIN_STATUSES = ['Seedling', 'Pikmin', 'Decor'];
        const YELLOW_PUNS = ['Yellen', 'Yell-o', 'Yell-sa', 'Yell-iot', 'Yell-iver', 'Yell-vis', 'Yell-izabeth', 'Yell-ington', 'Yell-ia', 'Yell-as'];

        const COLOR_CLASSES = {
          'Red': 'bg-red-500', 'Yellow': 'bg-yellow-400', 'Blue': 'bg-blue-500', 
          'White': 'bg-slate-300', 'Purple': 'bg-purple-600', 'Rock': 'bg-slate-700', 
          'Wing': 'bg-pink-400', 'Ice': 'bg-cyan-300'
        };

        const STATUS_ICONS = {
          'Seedling': <i className="fa-solid fa-seedling text-green-500"></i>,
          'Pikmin': <i className="fa-solid fa-ghost text-blue-500"></i>,
          'Decor': <i className="fa-solid fa-star text-amber-500"></i>
        };

        // --- COMPONENTS ---

        const Dashboard = ({ entries, onExport }) => {
          const total = entries.length;
          const seedlings = entries.filter(p => p.status === 'Seedling').length;
          const decorCount = entries.filter(p => p.status === 'Decor').length;
          const completionRate = total > 0 ? Math.round((decorCount / total) * 100) : 0;

          const stats = [
            { label: 'Total Count', value: total, icon: 'fa-box-archive', color: 'text-sage', bg: 'bg-sage-light' },
            { label: 'Seedlings', value: seedlings, icon: 'fa-seedling', color: 'text-sage', bg: 'bg-sage-light' },
            { label: 'Decor Complete', value: `${completionRate}%`, icon: 'fa-award', color: 'text-sage-dark', bg: 'bg-sage-light' },
          ];

          return (
            <div className="space-y-6 mb-8">
              <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                <div>
                  <h3 className="text-xl font-black text-slate-800 uppercase tracking-tighter">Collection Dashboard</h3>
                  <p className="text-xs font-bold text-soft-slate">Overview of your current progress</p>
                </div>
                <button onClick={onExport} className="flex items-center justify-center gap-2 px-6 py-3.5 rounded-2xl bg-white border border-slate-200 text-soft-slate font-black text-[10px] uppercase tracking-widest hover:bg-sage-light hover:border-sage/20 hover:text-sage transition-all active:scale-95 group">
                  <i className="fa-solid fa-file-export text-sage group-hover:scale-110 transition-transform"></i>
                  Export CSV
                </button>
              </div>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                {stats.map((stat, i) => (
                  <div key={i} className="bg-white p-6 rounded-[2rem] border border-slate-100 flex items-center gap-5 transition-colors hover:border-sage/20">
                    <div className={`${stat.bg} ${stat.color} w-14 h-14 rounded-2xl flex items-center justify-center shrink-0`}>
                      <i className={`fa-solid ${stat.icon} text-xl`}></i>
                    </div>
                    <div>
                      <p className="text-soft-slate text-[10px] font-black uppercase tracking-[0.15em]">{stat.label}</p>
                      <p className="text-3xl font-black text-slate-800">{stat.value}</p>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          );
        };

        const PikminForm = ({ onAdd }) => {
          const [name, setName] = useState('');
          const [color, setColor] = useState('Red');
          const [decorType, setDecorType] = useState('Roadside');
          const [status, setStatus] = useState('Seedling');

          const handleSuggestName = () => {
            setName(YELLOW_PUNS[Math.floor(Math.random() * YELLOW_PUNS.length)]);
          };

          const handleSubmit = (e) => {
            e.preventDefault();
            onAdd({ id: crypto.randomUUID(), name: name || `${color} Pikmin`, color, decorType, status, createdAt: Date.now() });
            setName('');
          };

          return (
            <div className="animate-in fade-in slide-in-from-bottom-4 duration-500 max-w-2xl mx-auto pt-4">
              <div className="sage-gradient-header rounded-t-[2.5rem] p-10 pb-24 shadow-sm text-center lg:text-left">
                <div className="flex flex-col lg:flex-row items-center gap-6 text-white">
                  <div className="bg-white/20 w-16 h-16 rounded-[1.5rem] flex items-center justify-center backdrop-blur-md shrink-0">
                    <i className="fa-solid fa-leaf text-3xl text-sage-light"></i>
                  </div>
                  <div>
                    <h2 className="text-3xl font-black tracking-tight">New Entry</h2>
                    <p className="text-sage-light/80 font-medium mt-1">Found a new seedling or grew a Pikmin?</p>
                  </div>
                </div>
              </div>
              <div className="bg-white mx-4 -mt-16 p-8 rounded-[2.5rem] form-card relative z-10 border-slate-100">
                <form onSubmit={handleSubmit} className="space-y-6">
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div className="space-y-2">
                      <label className="text-xs font-black text-soft-slate uppercase tracking-widest ml-1">Decor Category</label>
                      <select value={decorType} onChange={(e) => setDecorType(e.target.value)} className="w-full bg-warm-white border border-slate-100 rounded-2xl px-5 py-4 text-sm font-bold focus:ring-4 focus:ring-sage/10 outline-none transition-all appearance-none cursor-pointer">
                        {DECOR_TYPES.map(d => <option key={d} value={d}>{d}</option>)}
                      </select>
                    </div>
                    <div className="space-y-2">
                      <label className="text-xs font-black text-soft-slate uppercase tracking-widest ml-1">Color</label>
                      <select value={color} onChange={(e) => setColor(e.target.value)} className="w-full bg-warm-white border border-slate-100 rounded-2xl px-5 py-4 text-sm font-bold focus:ring-4 focus:ring-sage/10 outline-none transition-all appearance-none cursor-pointer">
                        {PIKMIN_COLORS.map(c => <option key={c} value={c}>{c}</option>)}
                      </select>
                    </div>
                  </div>
                  <div className="space-y-2">
                    <label className="text-xs font-black text-soft-slate uppercase tracking-widest ml-1">Pikmin Name</label>
                    <div className="relative">
                      <input type="text" value={name} onChange={(e) => setName(e.target.value)} placeholder="Enter a nickname..." className="w-full bg-warm-white border border-slate-100 rounded-2xl px-5 py-4 text-sm font-bold focus:ring-4 focus:ring-sage/10 outline-none transition-all" />
                      {color === 'Yellow' && (
                        <button type="button" onClick={handleSuggestName} className="absolute right-3 top-1/2 -translate-y-1/2 bg-yellow-400 hover:bg-yellow-500 text-yellow-900 font-black text-[10px] px-3 py-1.5 rounded-xl uppercase tracking-widest shadow-sm">Pun!</button>
                      )}
                    </div>
                  </div>
                  <div className="space-y-2">
                    <label className="text-xs font-black text-soft-slate uppercase tracking-widest ml-1">Current Status</label>
                    <div className="grid grid-cols-3 bg-warm-white p-1.5 rounded-[1.5rem] border border-slate-100 gap-1.5">
                      {PIKMIN_STATUSES.map(s => (
                        <button key={s} type="button" onClick={() => setStatus(s)} className={`py-3 text-[10px] font-black uppercase tracking-widest rounded-xl transition-all ${status === s ? 'bg-sage text-white shadow-md shadow-sage/10' : 'text-soft-slate hover:bg-white'}`}>
                          {s}
                        </button>
                      ))}
                    </div>
                  </div>
                  <button type="submit" className="w-full sage-gradient-header text-white font-black py-5 rounded-[1.5rem] shadow-lg shadow-sage/10 active:scale-[0.98] transition-all flex items-center justify-center gap-3 text-lg mt-4">
                    <i className="fa-solid fa-square-plus text-xl"></i> Add to Collection
                  </button>
                </form>
              </div>
            </div>
          );
        };

        const PikminList = ({ entries, onDelete, onEdit }) => {
          if (entries.length === 0) {
            return (
              <div className="flex flex-col items-center justify-center py-24 bg-white rounded-[2.5rem] border border-slate-100 shadow-sm">
                <div className="bg-warm-white w-24 h-24 rounded-full flex items-center justify-center mb-6 text-slate-200">
                  <i className="fa-solid fa-magnifying-glass text-4xl"></i>
                </div>
                <p className="font-black text-slate-800 uppercase tracking-widest">No entries found</p>
              </div>
            );
          }
          return (
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              {entries.map((pikmin) => (
                <div key={pikmin.id} className="bg-white p-5 rounded-[2rem] border border-slate-100 flex items-center gap-4 group hover:border-sage/30 transition-all">
                  <div className={`w-16 h-16 rounded-2xl ${COLOR_CLASSES[pikmin.color]} flex items-center justify-center shadow-sm shrink-0`}>
                    <i className="fa-solid fa-leaf text-white/90 text-2xl"></i>
                  </div>
                  <div className="flex-1 min-w-0">
                    <div className="flex items-center gap-2 mb-1">
                      <h4 className="font-black text-slate-800 truncate">{pikmin.name}</h4>
                      <span className="text-[10px] bg-warm-white text-soft-slate px-2 py-0.5 rounded-full font-black border border-slate-50 uppercase">{pikmin.color}</span>
                    </div>
                    <div className="flex flex-col gap-1">
                      <span className="text-[10px] font-black text-soft-slate uppercase tracking-widest flex items-center gap-1.5"><i className="fa-solid fa-location-dot text-sage/60"></i> {pikmin.decorType}</span>
                      <span className="text-[10px] font-black text-slate-600 uppercase tracking-widest flex items-center gap-1.5">{STATUS_ICONS[pikmin.status]} {pikmin.status}</span>
                    </div>
                  </div>
                  <div className="flex flex-col gap-2">
                    <button onClick={() => onEdit(pikmin)} className="w-10 h-10 rounded-xl bg-warm-white text-soft-slate hover:text-sage hover:bg-sage-light transition-all flex items-center justify-center"><i className="fa-solid fa-pen"></i></button>
                    <button onClick={() => onDelete(pikmin.id)} className="w-10 h-10 rounded-xl bg-warm-white text-soft-slate hover:text-red-400 hover:bg-red-50 transition-all flex items-center justify-center"><i className="fa-solid fa-trash-can"></i></button>
                  </div>
                </div>
              ))}
            </div>
          );
        };

        const EditModal = ({ entry, onClose, onSave }) => {
          const [name, setName] = useState('');
          const [status, setStatus] = useState('Seedling');
          useEffect(() => { if (entry) { setName(entry.name); setStatus(entry.status); } }, [entry]);
          if (!entry) return null;
          return (
            <div className="fixed inset-0 z-[200] flex items-center justify-center p-4">
              <div className="absolute inset-0 bg-slate-900/40 backdrop-blur-sm" onClick={onClose}></div>
              <div className="relative bg-white w-full max-w-md rounded-[2.5rem] shadow-xl overflow-hidden p-8 animate-in fade-in zoom-in duration-200 border border-slate-100">
                <h3 className="text-xl font-extrabold text-slate-800 mb-6 flex items-center gap-3"><i className="fa-solid fa-pen-to-square text-sage"></i> Edit Pikmin</h3>
                <div className="space-y-6">
                  <div className="space-y-2">
                    <label className="text-sm font-bold text-slate-700 ml-1">Nickname</label>
                    <input type="text" value={name} onChange={(e) => setName(e.target.value)} className="w-full bg-warm-white border border-slate-100 rounded-2xl px-5 py-3.5 text-sm font-medium focus:ring-4 focus:ring-sage/10 outline-none transition-all" />
                  </div>
                  <div className="space-y-2">
                    <label className="text-sm font-bold text-slate-700 ml-1">Status</label>
                    <div className="flex flex-col gap-2">
                      {PIKMIN_STATUSES.map(s => (
                        <button key={s} onClick={() => setStatus(s)} className={`flex items-center justify-between px-5 py-3.5 rounded-2xl text-sm font-bold border transition-all ${status === s ? 'bg-sage border-sage text-white shadow-md shadow-sage/10' : 'bg-warm-white border-slate-100 text-soft-slate hover:border-sage/30'}`}>
                          {s} {status === s && <i className="fa-solid fa-check"></i>}
                        </button>
                      ))}
                    </div>
                  </div>
                  <div className="flex gap-3 pt-4">
                    <button onClick={onClose} className="flex-1 py-4 rounded-2xl bg-warm-white border border-slate-100 text-soft-slate font-bold">Cancel</button>
                    <button onClick={() => { onSave(entry.id, { name, status }); onClose(); }} className="flex-1 py-4 rounded-2xl bg-sage text-white font-bold">Save</button>
                  </div>
                </div>
              </div>
            </div>
          );
        };

        const App = () => {
          const [entries, setEntries] = useState(() => {
            // Robust initialization for localStorage as requested
            try {
                const myData = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
                return Array.isArray(myData) ? myData : [];
            } catch (e) {
                console.error("Storage load failed, starting fresh:", e);
                return [];
            }
          });
          const [activeTab, setActiveTab] = useState('log');
          const [editingPikmin, setEditingPikmin] = useState(null);
          const [filterColor, setFilterColor] = useState('');
          const [filterDecor, setFilterDecor] = useState('');
          const [filterStatus, setFilterStatus] = useState('');

          useEffect(() => { localStorage.setItem(STORAGE_KEY, JSON.stringify(entries)); }, [entries]);

          const handleExportCSV = () => {
            if (entries.length === 0) return alert("No data to export!");
            const escape = (v) => `"${v.replace(/"/g, '""')}"`;
            const csv = [
                ["Decor Category", "Color", "Name", "Status"].join(","),
                ...entries.map(e => [escape(e.decorType), escape(e.color), escape(e.name), escape(e.status)].join(","))
            ].join("\n");
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url; a.download = "my_pikmin_collection.csv"; a.click();
          };

          const filteredEntries = useMemo(() => entries.filter(e => (!filterColor || e.color === filterColor) && (!filterDecor || e.decorType === filterDecor) && (!filterStatus || e.status === filterStatus)), [entries, filterColor, filterDecor, filterStatus]);

          return (
            <div className="flex flex-col md:flex-row min-h-screen bg-warm-white">
              <aside className="hidden md:flex md:w-80 bg-white border-r border-slate-100 flex-col sticky top-0 h-screen">
                <div className="p-10"><div className="flex items-center gap-4 text-sage"><i className="fa-solid fa-leaf text-4xl"></i><h1 className="text-2xl font-black text-slate-800 uppercase tracking-tighter">Pikmin Manager</h1></div></div>
                <nav className="flex-1 px-6 space-y-3">
                  <button onClick={() => setActiveTab('log')} className={`w-full flex items-center gap-5 px-6 py-5 rounded-[1.5rem] font-black uppercase tracking-widest text-xs transition-all ${activeTab === 'log' ? 'bg-sage text-white shadow-lg' : 'text-soft-slate hover:bg-sage-light'}`}><i className="fa-solid fa-circle-plus"></i> Log Entry</button>
                  <button onClick={() => setActiveTab('collection')} className={`w-full flex items-center gap-5 px-6 py-5 rounded-[1.5rem] font-black uppercase tracking-widest text-xs transition-all ${activeTab === 'collection' ? 'bg-sage text-white shadow-lg' : 'text-soft-slate hover:bg-sage-light'}`}><i className="fa-solid fa-shapes"></i> Collection</button>
                </nav>
              </aside>
              <main className="flex-1 px-4 lg:px-16 py-8 pb-32">
                {activeTab === 'log' ? <PikminForm onAdd={(e) => { setEntries([e, ...entries]); setActiveTab('collection'); }} /> : (
                  <div className="max-w-6xl mx-auto space-y-10">
                    <Dashboard entries={entries} onExport={handleExportCSV} />
                    <section className="bg-white p-8 rounded-[2.5rem] border border-slate-100 flex flex-wrap gap-6 items-end">
                      <div className="flex-1 min-w-[150px]"><label className="text-[10px] font-black uppercase tracking-widest text-soft-slate">Color</label><select value={filterColor} onChange={e => setFilterColor(e.target.value)} className="w-full bg-warm-white border border-slate-100 rounded-2xl px-5 py-3 text-xs font-bold appearance-none"><option value="">All Colors</option>{PIKMIN_COLORS.map(c => <option key={c} value={c}>{c}</option>)}</select></div>
                      <div className="flex-1 min-w-[150px]"><label className="text-[10px] font-black uppercase tracking-widest text-soft-slate">Category</label><select value={filterDecor} onChange={e => setFilterDecor(e.target.value)} className="w-full bg-warm-white border border-slate-100 rounded-2xl px-5 py-3 text-xs font-bold appearance-none"><option value="">All Categories</option>{DECOR_TYPES.map(d => <option key={d} value={d}>{d}</option>)}</select></div>
                      <div className="flex-1 min-w-[150px]"><label className="text-[10px] font-black uppercase tracking-widest text-soft-slate">Status</label><select value={filterStatus} onChange={e => setFilterStatus(e.target.value)} className="w-full bg-warm-white border border-slate-100 rounded-2xl px-5 py-3 text-xs font-bold appearance-none"><option value="">All Statuses</option>{PIKMIN_STATUSES.map(s => <option key={s} value={s}>{s}</option>)}</select></div>
                      <button onClick={() => { setFilterColor(''); setFilterDecor(''); setFilterStatus(''); }} className="px-6 py-3 text-xs font-black text-soft-slate uppercase tracking-widest">Reset</button>
                    </section>
                    <PikminList entries={filteredEntries} onDelete={id => setEntries(entries.filter(e => e.id !== id))} onEdit={setEditingPikmin} />
                  </div>
                )}
              </main>
              <nav className="md:hidden fixed bottom-6 left-1/2 -translate-x-1/2 w-[90%] bg-white border border-slate-100 rounded-[2.5rem] py-4 px-10 flex justify-between items-center shadow-xl z-50">
                <button onClick={() => setActiveTab('log')} className={`flex flex-col items-center ${activeTab === 'log' ? 'text-sage' : 'text-slate-300'}`}><i className="fa-solid fa-circle-plus text-2xl"></i><span className="text-[8px] font-black uppercase">Log</span></button>
                <button onClick={() => setActiveTab('collection')} className={`flex flex-col items-center ${activeTab === 'collection' ? 'text-sage' : 'text-slate-300'}`}><i className="fa-solid fa-shapes text-2xl"></i><span className="text-[8px] font-black uppercase">Collection</span></button>
              </nav>
              <EditModal entry={editingPikmin} onClose={() => setEditingPikmin(null)} onSave={(id, up) => setEntries(entries.map(e => e.id === id ? {...e, ...up} : e))} />
            </div>
          );
        };

        // Window Onload wrapper for reliable initialization
        window.onload = function() {
            console.log("App initialization started...");
            try {
                const rootElement = document.getElementById('root');
                if (rootElement) {
                    const root = ReactDOM.createRoot(rootElement);
                    root.render(<App />);
                    console.log("App initialized successfully");
                } else {
                    console.error("Critical error: Root element not found");
                }
            } catch (err) {
                console.error("Mounting error:", err);
            }
            console.log("App initialization complete");
        };
    </script>
</body>
</html>